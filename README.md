# SFTP Client Tests

Этот репозиторий содержит автотесты для проверки работы клиента SFTP. Тесты основаны на фреймворке TestNG и предназначены как для локального запуска из исходного кода, так и для использования в виде jar‑файла.

## Требования

- Java SE 8 или более новый (компиляция выполняется с целевой платформой Java 8).

- Maven, если вы собираетесь запускать тесты из исходников. Для запуска собранного jar достаточно JRE.

## Структура

- `src/test/java/` - тестовые классы.
- `src/test/resources` - ресурсы, необходимые для сборки и работы тестов.
- `src/test/resources/testng.xml` - конфигурация TestNG, описывающая параметры подключения и какие тесты запускать.
- `resources` - содержит файлы для запуска собранного jar-файла тестов, а также expect-скрипт

## Сборка тестов

1. Укажите значение параметров подключения в файле testng.xml: параметры host (адрес SFTP-сервера), port, user и password.

2. Сформируйте архив тестов командой:
```
mvn clean package
```
При сборке будет создан файл target/sftp-client-tests-0.1-jar-with-dependencies.jar. В него включены все тестовые классы и необходимые зависимости.
3. Положите в одну директорию файлы sftp-client-tests-0.1-jar-with-dependencies.jar, sftp-client-0.1-jar-with-dependencies.jar и testng.xml.

## Запуск тестов

### Из исходного кода

1. Клонируйте репозиторий или распакуйте архив с проектом.

2. В каталоге sftp-client-tests выполните команду:
```
mvn clean test
```
Maven скачает зависимости, скомпилирует тесты и запустит их с конфигурацией из src/test/resources/testng.xml. По окончании в каталоге target/surefire-reports появятся отчёты о прохождении тестов.

### В виде исполняемого jar

1. Перед сборкой запустите jar-файл клиента:
```
java -jar sftp-client-0.1-jar-with-dependencies.jar
```

2. Запустите jar в директории, подготовленной на стадии сборки тестов:
```
java -jar sftp-client-tests-0.1-tests.jar testng.xml
```

## Запуск Expect-скрипта (Linux)

1. Установите expect:
```
sudo apt-get install expect
```

2. Поместите e2e_list.expect, sftp-client-0.1-jar-with-dependencies.jar и domains.json в домашнюю директорию пользователя
3. Запустите Expect-скрипт из домашней директории пользователя:
```
expect e2e_list.expect
```

## Описание тестов

### Проверка валидации IP‑адресов (IpValidationTest)

Этот набор тестов проверяет корректность функции isValidIPv4.

Позитивные сценарии убеждаются, что функция принимает допустимые IPv4‑адреса вроде 0.0.0.0, 127.0.0.1, 255.255.255.255 и т.д.

Негативные сценарии проверяют, что отклоняются пустые строки, null, адреса с неверным числом октетов, числами вне диапазона [0;255], ведущими нулями и посторонними символами.

Такая проверка необходима, чтобы клиент не пытался подключаться по некорректным адресам и заранее отсеивал ошибочные вводы пользователя.

### Логика управления доменами (DomainManagerTest)

Тестируется класс DomainManager, который отвечает за загрузку и сохранение пар домен–IP.

Проверяется, что загрузка JSON из входного потока корректно заполняет внутренние структуры и возвращает упорядоченную карту.

Негативные проверки подтверждают, что домены с некорректными IP‑адресами (например, с ведущими нулями или значениями >255) отклоняются.

Эти тесты гарантируют стабильную работу логики хранения доменов и предотвращают возникновение конфликтов данных.

### Интеграция с SFTP‑сервером (SftpIntegrationTest)

Проверяется корректность взаимодействия клиента с SFTP‑сервером. Тесты используют параметризованные значения из testng.xml (host, port, user, password):

Подключаются к тестовому SFTP‑серверу и убеждаются, что соединение успешно.

Загружают файл, читают содержимое и проверяют, что оно содержит ожидаемые данные.

Модифицируют файл, загружают его обратно на сервер, а затем скачивают ещё раз и сравнивают, что содержимое не изменилось.

Такие проверки позволяют убедиться, что сетевые операции чтения и записи отрабатывают без ошибок, а клиент корректно обрабатывает бинарные потоки.